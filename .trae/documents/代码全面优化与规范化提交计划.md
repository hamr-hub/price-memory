## 优化目标
- 代码符合项目编码规范与安全最佳实践，提升可读性与可维护性
- 针对性能瓶颈进行优化，降低抓取失败率与响应时间
- 完善错误处理与日志记录，增强可观测性与问题定位能力
- 更新文档、注释与README，保证开发与使用指引一致

## 优化范围
- 后端（FastAPI + Playwright + Supabase/SQLite）：架构、数据层、抓取稳健性、接口契约、导出能力
- 前端（React + Vite + AntD）：表格交互、状态管理、错误提示、性能
- 测试与CI：Pytest、前端构建校验、最小E2E脚本
- 文档：开发与部署指南、环境变量、安全注意事项

## 后端优化
- 结构与规范：模块边界清晰（parsers/spider/api/dal），移除未使用依赖与死代码
- 性能与稳健：
  - Playwright：随机UA/时区/离散延时，站点速率限制与最小请求间隔，网络异常重试
  - 解析兜底：多站点选择器容错、价格文案解析健壮（货币与数字拆分）
  - Supabase DAL：统一重试与超时设置、分页读取与原子写入、潜在唯一约束防重（同商品同时间同价去重）
- 错误处理与日志：统一响应格式，关键路径日志（任务创建/执行/失败），结构化错误包含上下文；敏感信息不入日志
- API契约：分页筛选排序接口、批量导出；保持向后兼容

## 前端优化
- 表格交互：搜索/分类筛选/排序/分页；批量抓取与批量导出；历史价格图表（react-chartjs-2）
- 错误与体验：请求状态提示、失败重试、空态与加载骨架；避免不必要重渲染（memo/useCallback）
- 配置与安全：通过 `VITE_API_URL` 切换环境；避免在代码中硬编码密钥

## 测试与CI
- 单元测试：解析器（多区域选择器与价格解析）、API最小健康检查
- 集成测试：任务创建→执行→价格写入→导出
- E2E（轻量）：前端表格加载与基本操作脚本（可后续补齐）
- CI：后端pytest、前端构建；门禁确保红灯不可推主分支

## 文档与注释
- README：项目概述、运行方式、环境变量（SUPABASE_URL/KEY、DATABASE_URL）、安全说明
- 开发指南：模块说明、约定、调试与测试；部署注意（Playwright浏览器安装）
- 代码注释：关键函数/算法/兼容性选择器说明，避免噪声注释

## Commit规范（原子性）
- 格式示例：
  - `refactor: restructure spider dal with retry`
  - `feat(api): add /products/search and multi-export`
  - `fix(parser): robust currency parsing for amazon.de`
  - `test: add api search endpoint health check`
  - `docs: update README with env injection and supabase`
  - `style(frontend): table filters and bulk actions UX polish`
- 原子性：每个commit只包含单一逻辑修改（代码+对应测试+文档同步）

## 推送流程（规范化）
1. 本地拉取更新：`git pull --rebase origin main`
2. 解决冲突：保持当前结构，优先保留统一响应与新接口；运行 `npm run build` 与 `pytest` 验证
3. 提交：按原子性拆分commit并编写规范消息
4. 本地测试：后端 `pytest`、前端 `npm run build` 通过
5. 推送：`git push origin main`
6. PR（必要时）：创建到主分支的 PR，触发CI，邀请评审

## 风险与回滚
- 解析选择器变动：保持多兜底与回退逻辑
- Supabase限流/网络抖动：客户端重试与错误包装，不影响整体服务；出现问题可切换至SQLite回退模式
- 部署环境Playwright：确保浏览器安装脚本执行；失败时禁用抓取功能并提示

## 交付物
- 优化后的后端与前端代码（按规范提交）、测试用例与CI配置
- 更新文档（README/开发指南）
- 规范化的提交记录与PR说明

## 需要你确认/提供
- 远程仓库地址与推送权限（若需我代为推送）
- Supabase项目的 `SUPABASE_URL` 与 `SUPABASE_KEY`（用于本地与CI的集成验证）

确认后，我将按以上计划进行代码审查与重构、补齐测试与文档、分原子commit推送，并在必要时创建 PR 进行代码评审。