# Price Memory 开发指南

## 环境要求

### 系统要求
- 操作系统: macOS / Linux / Windows
- Node.js: >= 18
- Python: >= 3.10
- Git: 最新版本

### 开发工具推荐
- **IDE**: VS Code / WebStorm / PyCharm
- **浏览器**: Chrome / Firefox (用于调试)
- **数据库工具**: pgAdmin / DBeaver
- **API测试**: Postman / Insomnia

## 环境搭建

### 1. 克隆项目
```bash
git clone https://github.com/your-username/price-memory.git
cd price-memory
```

### 2. 前端环境搭建

#### 安装依赖
```bash
cd admin
npm install
```

#### 环境配置
创建 `.env.local` 文件：
```env
VITE_API_URL=http://localhost:8000/api/v1
```

#### 启动前端
```bash
npm run dev
```
访问 `http://localhost:5173`。

### 3. 后端环境搭建

#### 安装依赖
```bash
cd spider
python -m venv .venv
.venv\Scripts\pip install -U pip
.venv\Scripts\pip install -r requirements.txt
```

如使用 `pyproject.toml`：
```bash
pip install uv
uv sync
```

#### 环境变量（可选）
在终端设置或创建 `.env`：
```env
DATABASE_URL=sqlite:///spider.db
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-supabase-key
```

#### 安装 Playwright 浏览器
```bash
.venv\Scripts\python -m playwright install
```

#### 启动后端
```bash
spider\.venv\Scripts\uvicorn.exe spider.main:app --host 127.0.0.1 --port 8000
```

### 4. 数据库

- 默认使用 SQLite 文件 `spider.db`
- 配置 `DATABASE_URL` 可切换到 PostgreSQL 或 Supabase

## 开发流程

### 分支策略
- `main`: 生产分支
- `develop`: 开发分支
- `feature/*`: 功能分支
- `hotfix/*`: 紧急修复

### 代码规范

前端：
```bash
npm run lint
npm run format
npm run type-check
```

后端：
```bash
ruff format .
ruff check .
mypy .
```

### 3. 提交规范

使用 Conventional Commits 规范：

```bash
# 功能开发
git commit -m "feat: 添加商品价格监控功能"

# 问题修复
git commit -m "fix: 修复爬虫超时问题"

# 文档更新
git commit -m "docs: 更新API文档"

# 样式调整
git commit -m "style: 调整按钮样式"

# 重构代码
git commit -m "refactor: 重构数据处理模块"

# 性能优化
git commit -m "perf: 优化数据库查询性能"

# 测试相关
git commit -m "test: 添加单元测试"
```

## 测试指南

前端：
```bash
npm run test
```

后端：
```bash
pytest -v
```

#### API测试
```bash
# 运行API测试
uv run pytest tests/api/

# 性能测试
uv run pytest tests/performance/
```

## 调试

前端：使用浏览器 DevTools 与 React DevTools

后端：使用 `uvicorn` 日志与 `logging`，必要时 `pdb` 断点调试

## 性能优化

### 1. 前端性能优化

#### 构建优化
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          antd: ['antd', '@ant-design/icons']
        }
      }
    }
  }
})
```

#### 代码分割
```typescript
// 懒加载组件
const LazyComponent = lazy(() => import('./LazyComponent'))
```

### 2. 后端性能优化

#### 异步处理
```python
# 使用异步函数
async def fetch_price(url: str) -> float:
    async with httpx.AsyncClient() as client:
        response = await client.get(url)
        return parse_price(response.text)
```

#### 缓存策略
```python
# Redis缓存
@cache(expire=3600)
async def get_product_prices(product_id: int):
    return await db.fetch_prices(product_id)
```

## 常见问题

端口占用：调整 `vite.config.ts` 或 `uvicorn` 端口

Playwright 浏览器缺失：执行安装命令并重试

## 贡献

- 使用 Pull Request 提交变更
- 遵循 Conventional Commits 提交信息
