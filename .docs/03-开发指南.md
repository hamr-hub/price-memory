# Price Memory 开发指南

## 环境要求

### 系统要求
- **操作系统**: macOS / Linux / Windows
- **Node.js**: >= 18.0.0
- **Python**: >= 3.14
- **Git**: 最新版本

### 开发工具推荐
- **IDE**: VS Code / WebStorm / PyCharm
- **浏览器**: Chrome / Firefox (用于调试)
- **数据库工具**: pgAdmin / DBeaver
- **API测试**: Postman / Insomnia

## 环境搭建

### 1. 克隆项目
```bash
git clone https://github.com/your-username/price-memory.git
cd price-memory
```

### 2. 前端环境搭建

#### 安装依赖
```bash
cd admin
npm install
```

#### 环境配置
创建 `.env.local` 文件：
```env
# API配置
VITE_API_URL=http://localhost:8000
VITE_GRAPHQL_URL=https://your-graphql-url/graphql

# Refine配置
VITE_REFINE_PROJECT_ID=68Tn3q-k8Oh2h-ZA1WwU
```

#### 启动开发服务器
```bash
npm run dev
```

访问 http://localhost:5173 查看前端界面。

### 3. 后端环境搭建

#### 安装Python依赖管理工具
```bash
# 安装uv (推荐)
curl -LsSf https://astral.sh/uv/install.sh | sh

# 或使用pip
pip install uv
```

#### 安装项目依赖
```bash
cd spider
uv sync
```

#### 环境配置
创建 `.env` 文件：
```env
# 数据库配置
DATABASE_URL=postgresql://username:password@localhost:5432/price_memory
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-supabase-anon-key

# Redis配置
REDIS_URL=redis://localhost:6379

# 爬虫配置
USER_AGENT=Mozilla/5.0 (compatible; PriceMemoryBot/1.0)
REQUEST_DELAY=1000
```

#### 安装Playwright浏览器
```bash
uv run playwright install
```

#### 启动开发服务器
```bash
uv run python main.py
```

### 4. 数据库搭建

#### 本地PostgreSQL安装
```bash
# macOS
brew install postgresql
brew services start postgresql

# Ubuntu
sudo apt-get install postgresql postgresql-contrib
sudo systemctl start postgresql

# 创建数据库
createdb price_memory
```

#### 数据库初始化
```sql
-- 连接到数据库
psql -d price_memory

-- 创建基础表结构
\i database/schema.sql
```

## 开发流程

### 1. 分支管理策略

#### 主要分支
- `main`: 生产环境分支
- `develop`: 开发环境分支
- `feature/*`: 功能开发分支
- `hotfix/*`: 紧急修复分支

#### 工作流程
```bash
# 1. 从develop创建功能分支
git checkout develop
git pull origin develop
git checkout -b feature/new-feature

# 2. 开发完成后提交
git add .
git commit -m "feat: add new feature"

# 3. 推送并创建PR
git push origin feature/new-feature
# 在GitHub创建Pull Request

# 4. 代码审查通过后合并
git checkout develop
git pull origin develop
git branch -d feature/new-feature
```

### 2. 代码规范

#### 前端代码规范
```bash
# 代码格式化
npm run format

# 代码检查
npm run lint

# 类型检查
npm run type-check
```

#### 后端代码规范
```bash
# 代码格式化
uv run ruff format .

# 代码检查
uv run ruff check .

# 类型检查
uv run mypy .
```

### 3. 提交规范

使用 Conventional Commits 规范：

```bash
# 功能开发
git commit -m "feat: 添加商品价格监控功能"

# 问题修复
git commit -m "fix: 修复爬虫超时问题"

# 文档更新
git commit -m "docs: 更新API文档"

# 样式调整
git commit -m "style: 调整按钮样式"

# 重构代码
git commit -m "refactor: 重构数据处理模块"

# 性能优化
git commit -m "perf: 优化数据库查询性能"

# 测试相关
git commit -m "test: 添加单元测试"
```

## 测试指南

### 1. 前端测试

#### 单元测试
```bash
# 运行测试
npm run test

# 测试覆盖率
npm run test:coverage

# 监听模式
npm run test:watch
```

#### E2E测试
```bash
# 安装Playwright
npm run test:e2e:install

# 运行E2E测试
npm run test:e2e
```

### 2. 后端测试

#### 单元测试
```bash
# 运行测试
uv run pytest

# 测试覆盖率
uv run pytest --cov=.

# 详细输出
uv run pytest -v
```

#### API测试
```bash
# 运行API测试
uv run pytest tests/api/

# 性能测试
uv run pytest tests/performance/
```

## 调试指南

### 1. 前端调试

#### 浏览器调试
- 使用Chrome DevTools
- React Developer Tools扩展
- Redux DevTools扩展

#### VS Code调试配置
```json
{
  "type": "node",
  "request": "launch",
  "name": "Debug React App",
  "runtimeExecutable": "npm",
  "runtimeArgs": ["run", "dev"]
}
```

### 2. 后端调试

#### Python调试
```python
# 使用pdb调试器
import pdb; pdb.set_trace()

# 使用logging
import logging
logging.basicConfig(level=logging.DEBUG)
```

#### VS Code调试配置
```json
{
  "type": "python",
  "request": "launch",
  "name": "Debug FastAPI",
  "program": "main.py",
  "console": "integratedTerminal"
}
```

## 性能优化

### 1. 前端性能优化

#### 构建优化
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          antd: ['antd', '@ant-design/icons']
        }
      }
    }
  }
})
```

#### 代码分割
```typescript
// 懒加载组件
const LazyComponent = lazy(() => import('./LazyComponent'))
```

### 2. 后端性能优化

#### 异步处理
```python
# 使用异步函数
async def fetch_price(url: str) -> float:
    async with httpx.AsyncClient() as client:
        response = await client.get(url)
        return parse_price(response.text)
```

#### 缓存策略
```python
# Redis缓存
@cache(expire=3600)
async def get_product_prices(product_id: int):
    return await db.fetch_prices(product_id)
```

## 常见问题

### 1. 环境问题

**Q: Node.js版本不兼容**
```bash
# 使用nvm管理Node.js版本
nvm install 18
nvm use 18
```

**Q: Python版本不兼容**
```bash
# 使用pyenv管理Python版本
pyenv install 3.14
pyenv local 3.14
```

### 2. 依赖问题

**Q: npm install失败**
```bash
# 清除缓存重新安装
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

**Q: uv sync失败**
```bash
# 更新uv到最新版本
uv self update
uv sync --refresh
```

### 3. 运行时问题

**Q: 端口被占用**
```bash
# 查找占用端口的进程
lsof -i :5173
kill -9 <PID>
```

**Q: 数据库连接失败**
```bash
# 检查数据库服务状态
pg_ctl status
brew services restart postgresql
```

## 贡献指南

### 1. 提交PR流程
1. Fork项目到个人仓库
2. 创建功能分支
3. 完成开发和测试
4. 提交PR并描述变更
5. 等待代码审查
6. 根据反馈修改代码
7. PR合并后删除分支

### 2. 代码审查标准
- 代码风格符合项目规范
- 功能实现正确完整
- 测试覆盖率达标
- 文档更新及时
- 性能影响可接受

### 3. 问题反馈
- 使用GitHub Issues报告问题
- 提供详细的复现步骤
- 包含环境信息和错误日志
- 标记问题类型和优先级